本文主要整理Assignment 2 (systems): Systems and Parallelism的主要内容。

## 2.4 4D Parallelism

### 1. **五大基础并行方法**

| 并行方法 | 核心思想 | 关键特点 |
|---------|---------|---------|
| **数据并行(DP)** | 数据批次分割到不同设备 | 各设备计算局部梯度，需全局平均 |
| **全分片数据并行(FSDP)** | 优化器状态、梯度、权重分片 | 前向/反向传播前需收集权重分片 |
| **张量并行(TP)** | 激活值沿新维度分片 | 可按操作输入或输出维度分片 |
| **流水线并行(PP)** | 模型按层分阶段 | 不同阶段运行在不同设备 |
| **专家并行(EP)** | 专家模型中的专家分离 | 专用于MoE（专家混合）模型 |

### 2. **4D并行化框架构建**

**框架整合逻辑：**
- **FSDP + TP 组合** → 视为单一并行轴（互补性强）
- **保留DP** → 数据维度并行
- **保留PP** → 模型层次维度并行  
- **排除EP** → 聚焦稠密模型（非MoE）
- **最终得到4个并行轴**：DP、FSDP/TP、PP

### 3. **设备网格组织理念**

**核心概念：** 将计算集群抽象为**设备网格**(Device Mesh)，每个网格轴对应一个并行维度。

**实例说明：** 16个GPU可组织为4×4网格：
- **第一维(4)** → 数据并行(DP)
- **第二维(4)** → FSDP/TP组合并行

### 4. **技术选型指导**

**推荐组合：** FSDP与TP协同使用（权重与激活值沿对应维度分片）
**应用聚焦：** 主要针对**稠密模型**（非稀疏的MoE模型）
**规模适配：** 根据不同模型规模和硬件配置灵活调整并行策略

### 5. **学习资源指引**

- **理论基础**：TPU Scaling Book Part 5（通信与内存成本分析）
- **实践深入**：Ultra-Scale Playbook（流水线并行详解）
- **综合参考**：相关书籍提供的完整技术体系

### 技术价值与启示

该4D并行框架代表了当前大规模深度学习训练的**最先进范式**，通过多维度的并行策略组合，有效解决了单一模型在单个设备上无法容纳的挑战。这种分层并行的思想不仅适用于当前的Transformer架构，也为未来更大规模模型的高效训练提供了理论基础和实践路径。